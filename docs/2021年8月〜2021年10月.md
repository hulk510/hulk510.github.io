# プロジェクト名

- C2CプラットフォームのWebサービス開発

## プロジェクトの詳細

コーチングや英語学習、一緒に遊ぶなどができるクリエイターとプレーヤを繋ぐC2CプラットフォームのWebサービス開発に参加しました。主にフロントエンドの改修タスクおよび、リプレイスを担当しました。また、リプレイスに合わせてバックエンドAPIの修正も行いました。

## 使用技術

- API, 管理画面（Active Admin）：Ruby on Rails, Ruby
- インフラAWS: ELB, EC2 ECS
- フロントエンド：Next.js, React, SCSS Typescript

## 参加期間

- 2021年8月~2021年10月

## 開発規模

- 6人

## プロジェクトでの課題

旧サービスから新サービスへの移行に伴い、ユーザーにとって使いやすく、スムーズな移行を実現することが目標でした。また、フロントエンドのリプレイスも進める必要があり、その中でマイページとマイページ内の項目の新規ページ作成を担当しました。

プロフィール変更ページやクレジットカード登録ページ、Line連携ページなど、複数のページの新規作成やバグ修正が必要でした。また、実装に際して画像アップロードのバグ特定が難しいという課題もありました。

管理画面では使っているActiveAdminで用意されているcsvでは表示される予約一覧の形式が適切に表示されないため、指定のフォーマットに変更する必要がありました。

## 主な取り組み

### フロントエンド

ページデザインはすでにFigmaで作成されていたため、デザインの実装は適宜scssに落とし込むことで対応しました。Figmaのデザインをそのまま流用できなかったため、間隔の調整などはページでの表示を見つつ地道に調整しました。その際、固定の幅で定義してしまうとブラウザサイズによっては表示されなかったりするため、可変で変えられるようにmediaクエリを使ってPC, スマホでの画面を出し分けられるように注意しながら実装しました。また、マイページで使うデザインは同じようなものが多かったため、ページを実装する前に個々のページで使われていた共通のデザインをコンポーネントに落とし込み同じ実装をしないで済むようにしました。

#### 実装ページ

- プロフィール変更

  プロフィール変更ページでは、名前、アイコン画像のアップロード処理などをカスタムフックでロジックを作成しました。画像アップロード自体は他でも使ったりしそうな処理なので、カスタムフックとして定義することでロジックを再利用可能な形にして汎用性を持たせた方が便利と判断しました。
  アップロード機能作成時、苦労した点はmediaファイルのアップロードがうまくできなかったことです。具体的にはAPIリクエストのパラメーターに含めているはずなのに、APIで受け取る際には消えているという現象が発生していました。関係してそうな箇所が複数考えられたため、いくつか処理やAPI、Proxyごとに分けどの部分が原因になっているか調査しました。ブラウザの管理ツールでAPIリクエスト時のパラメータを調べる中でProxyを使っていることがわかり、Proxy処理内部でデバックコードを差し込むなどして原因を特定しました。起こっていた現象で検索するとissueでのやり取りが見つかったのでbodyParserの設定を修正しアップロードできました。

- クレジットカード登録

  デザインなどもマイページ用に共通定義したコンポーネントを流用しながら実装を進めました、クレジットカードを変更するAPIは既に出来ていたため、リクエスト部分のロジックの実装だけで特に難なく実装することが出来ました。バリデーションなどは旧サービスで使われていた正規表現を適用しすることでフロント側でもバリデーションをかけ登録ページを作成しました。

- Line連携

  Lineの連携ロジックもAPI側ですでに作成されていたため、同じようにリクエスト部分の作成を行ないました。Line連携してるかしてないかは、idがデータベースに登録されてるかどうかで判定する処理をフロント側で作成しました。
  連携時Lineログイン後のコールバック処理の実装に苦労しましたが、フロント側でコールバック処理を受けとり再度APIにリクエスト・リダイレクトするページを新しく作成しました。コールバック処理はすぐには理解しづらいため、旧サービスでの大まかな流れを書いた簡易的な処理フロー図を作成し、新しく実装するページの処理フロー図に適宜アップデートしながら全体を把握していくことで必要な処理の実装をしました。

- ユーザーのアイコンが表示されないバグの修正

  画像をアップロードしてプロフィールの変更画面を本番にアップロードした際、このバグが発覚しました。原因としてはnext.config.jsで本番環境のドメインのみ登録されておらず、本番環境でユーザーの画像が適切に表示されいことがissueなどでのやり取りから分かったため、ドメインを追加することで修正しました。その際、作成したプロジェクトのバグIssueに関しては、そのバグが発生する条件や発生時の画像などを書き、調べた情報なども全てIssueに記載していきました。課題解決までの情報を1つに紐づけておくようにすることで、後から見ても何が原因でどうなっているのかが分かるように書くことを心がけました。

### バックエンド

- 管理画面で表示される予約一覧のcsvの生成フォーマット修正

  ActiveAdminではcsv形式をオーバーライドして指定のフォーマットにできるため、必要なデータの確認とそのデータが保管されている場所の確認を行い実装しました。どのデータがどこに保持されているかなどをRails内のモデルやDBのテーブル構造から紐付きの状態を確認しつつアイテム内部で紐付き先のデータを呼び出すことでcsvの形式を変更しました。

### インフラ

- 完成したページを旧サービスページから新サービスページへの移行
  AWSマネジメントコンソールからロードバランサーの設定を変更し、完成したページを旧サービスページから新ページへとリダイレクトする設定をしました。具体的には、ELBのリスナールールから、修正したページpathの転送先であるターゲットグループのECSを変更し新しいページを向くようにしました。また、デグレした際戻せるようにしておく必要があると考え、変更する設定の状態をスクリーンショットで撮りつつ修正を行えるようにしました。

## 振り返り

すぐに実装に着手せず、大まかに共通化できそうな部分の洗い出しをして実装していたことで、ページ単体の実装が比較的早くできたと考えています。マイページのデザインの調整なども同じコンポーネントであるためcssの修正などを簡単だったことも良かった点でした。
アップロードバグの修正経験などを通して、初期に比べエラーの特定と修正する力が着実に付いてきたと感じました。また、チームや個人での活動の中で、ある程度自走できる力を持てるようになったことが自信になったと考えています。
